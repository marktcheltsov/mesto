(()=>{"use strict";var e={d:(t,o)=>{for(var s in o)e.o(o,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{$C:()=>c});class t{constructor(e,t,o,s,n,i){this._templateSelector=o,this._name=e.name,this._link=e.link,this._id=e.id,this.cardId=e.cardId,this.likes=e.likes,this._handleOpenImage=t,this.removeBtn=e.removeBtn,this.removePopup=e.removePopup,this.handleRemoveLike=s,this.handleAddLike=n,this.handleRemoveCard=i}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}addlike(){this.likeCounter.textContent=this.likes+1,this._btnLike.classList.add("element__like_active")}removeLike(){this.likeCounter.textContent=this.likes,this._btnLike.classList.remove("element__like_active")}removeCardOnButtonClick(){this._buttonDeleteElement.closest(".element").remove()}_setEventListeners(){this._element=this._getTemplate(),this.likeCounter=this._element.querySelector(".element__like-counter"),this.likeCounter.textContent=this.likes,this._image=this._element.querySelector(".element__image"),this._btnLike=this._element.querySelector(".element__like"),this._buttonDeleteElement=this._element.querySelector(".element__delete-icon"),this._title=this._element.querySelector(".element__title"),this.removeCardOnButtonClick(),"d6cf05dde131a35a4a4474af"!==this._id&&this._buttonDeleteElement.remove(),this._btnLike.onclick=()=>{this._btnLike.classList.contains("element__like_active")?(this.handleRemoveLike(this.cardId),0==this.likes?(this.likeCounter.textContent=0,this.removeLike()):this.removeLike()):(this.handleAddLike(this.cardId),this.addlike())},this._buttonDeleteElement.onclick=()=>{this.removePopup.classList.add("popup_opened"),this.removeBtn.onclick=()=>{this.removeCardOnButtonClick(),this.removePopup.classList.remove("popup_opened"),this.handleRemoveCard(this.cardId)}},this._image.onclick=()=>{this._handleOpenImage(this._name,this._link)}}generateCard(){return this._element=this._getTemplate(),this._setEventListeners(),this._title.textContent=this._name,this._image.src=this._link,this._image.alt=this._name,this._element}}class o{constructor(e,t){this._data=e,this._form=t,this.inputList=Array.from(this._form.querySelectorAll(e.popupInput)),this._btn=this._form.querySelector(this._data.popupSaveButton),this._inputTextEror=this._form.querySelector(this._data.errorText)}_showInputError(e){this._inputContainer=e.closest(this._data.popupInputContainer),this._inputTextEror=this._inputContainer.querySelector(this._data.errorText),e.classList.add(this._data.popupInputError),this._inputTextEror.classList.add(this._data.errorTextActive),this._inputTextEror.textContent=e.validationMessage}_hideInputError(e){this._inputContainer=e.closest(this._data.popupInputContainer),this._inputTextEror=this._inputContainer.querySelector(this._data.errorText),e.classList.remove(this._data.popupInputError),this._inputTextEror.classList.remove(this._data.errorTextActive),this._inputTextEror.textContent=""}setOnSubmitButton(){this._btn.removeAttribute("disabled",""),this._btn.classList.remove(this._data.inactiveButtonClass)}setOffSubmitButton(){this._btn.setAttribute("disabled",""),this._btn.classList.add(this._data.inactiveButtonClass)}cheakFormValid(){this._form.checkValidity()?this.setOnSubmitButton():this.setOffSubmitButton()}_setEventListeners(){this.inputList.forEach((e=>{e.oninput=()=>{e.validity.valid?this._hideInputError(e):this._showInputError(e),this.cheakFormValid()}}))}cleanForm(){this.inputList.forEach((e=>{e.value="",this._hideInputError(e),this.setOnSubmitButton()}))}setValidation(){this._setEventListeners()}}class s{constructor(e){this.popupSelector=e,this.popup=document.querySelector(this.popupSelector)}_handleEscClose=e=>{e.key==c&&this.close()};open(){this.popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this.popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this.popup.onclick=e=>{e.target==this.popup&&this.popup.classList.contains("popup_opened")&&this.close()}}}class n extends s{constructor(e,t){super(e),this.handleForm=t,this.form=this.popup.querySelector(".popup__form"),this.inputList=Array.from(this.form.querySelectorAll(".popup__input"))}_getInputValues(){return this.data={},this.inputList.forEach((e=>{const t=e.name,o=e.value;this.data[t]=o})),this.data}setEventListeners(){super.setEventListeners(),this.form.addEventListener("submit",(e=>{e.preventDefault(),this._getInputValues(),this.handleForm(this._getInputValues()),this.close()}))}}const i=document.querySelector(".profile__name"),r=document.querySelector(".profile__about"),a=document.querySelector(".profile__image"),p=new class{constructor(e,t){this.name=e,this.about=t,this.info={}}getUserInfo(){return this.info.name=this.name.textContent,this.info.about=this.about.textContent,this.info}setUserInfo(e,t){this.name.textContent=e,this.about.textContent=t}}(i,r),u=document.querySelector(".popup__input_type_name"),l=document.querySelector(".popup__input_type_about"),c=(document.getElementById("popup-cards__input_type_name"),document.getElementById("popup-cards__input_type_link"),"Escape"),h=document.querySelector(".profile__change-image"),d=document.querySelector(".popup-avatar__close-button"),_=document.querySelector(".pupup-avatar__save-button"),m=document.querySelector(".profile__edit-button"),v=(document.querySelector(".popup-profile"),document.querySelector(".popup-profile__close-button")),k=(document.querySelector(".popup-cards"),document.querySelector(".profile__card-button")),f=document.querySelector(".popup-cards__close-button"),y=(document.querySelector(".popup-image"),document.querySelector(".popup-image__img"),document.querySelector(".popup-image__title"),document.querySelector(".elements")),S=document.querySelector(".popup-image__close-button"),C=document.querySelector(".popup__profile-form"),b=document.querySelector(".popup__card-form"),L=(document.querySelector(".popup__avatar-form"),"Сохранить"),E=document.querySelector(".popup-cards__save-button"),g={formSelector:"popup__form",popupInput:".popup__input",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible",errorText:".popup__input-error-text",errorTextActive:"popup__input-error-text_active",popupInputError:"popup__input_error",popupInputContainer:".popup__input-container",popupSaveButton:".popup__save-button",popupContainer:".popup__container"},q=document.querySelector(".popup-profile__save-button"),I=new o(g,C),x=new o(g,b),T=new class extends s{constructor(e){super(e),this.image=document.querySelector(".popup-image__img"),this.title=document.querySelector(".popup-image__title")}open(e,t){this.image.src=t,this.image.alt=e,this.title.textContent=e,super.open()}}(".popup-image"),w=document.querySelector(".pupup-remove"),B=document.querySelector(".pupup-remove__save-button"),O=new s(".pupup-remove"),A=new n(".popup-cards",(e=>{const t=e.name,o=e.link;e.removeBtn=B,e.removePopup=w,e.id="d6cf05dde131a35a4a4474af";const s=F(e,((e,t)=>{T.open(e,t)}),".template",(e=>{V.deleteLike(e)}),(e=>{V.addLike(e)}),(e=>{V.removeCard(e)}));y.prepend(s),x.cleanForm(),x.setOffSubmitButton(),j(!0,E,"Создать"),V.pushCard(t,o).finally((()=>{j(!1,E,L)})),A.close()})),$=new n(".popup-avatar",(e=>{const t=e.link;a.src=t,j(!0,_,L),V.pushNewAvatar(t,j(!0,_,L)),$.close()})),P=new n(".popup-profile",(e=>{const t=e.name,o=e.about;p.setUserInfo(t,o),j(!0,q,L),V.pushNewUserInfo(t,o,j(!0,q,L)),P.close()})),U=[];function j(e,t,o){t.textContent=e?"Сохранение...":o}function F(e,o,s,n,i,r){return new t(e,o,s,n,i,r).generateCard()}const V=new class{constructor(e){this.options=e,this.token=e.token,this.address=e.address,this.owner=e.owner}getUserInfoFromServer(){return fetch(`${this.address}/users/${this.owner}`,{headers:{authorization:this.token}})}pushNewAvatar(e,t){fetch(`${this.address}/users/${this.owner}/avatar`,{method:"PATCH",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).finally((()=>{}))}pushNewUserInfo(e,t,o){fetch(`${this.address}/users/${this.owner}`,{method:"PATCH",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).finally((()=>{}))}deleteLike(e){fetch(`${this.address}/cards/${e}/likes`,{method:"DELETE",headers:{authorization:this.token,"Content-Type":"application/json"}})}addLike(e){fetch(`${this.address}/cards/${e}/likes`,{method:"PUT",headers:{authorization:this.token,"Content-Type":"application/json"}})}removeCard(e){fetch(`${this.address}/cards/${e}`,{method:"DELETE",headers:{authorization:this.token,"Content-Type":"application/json"}})}getCard(){return fetch(`${this.address}/cards`,{headers:{authorization:this.token}})}pushCard(e,t){return fetch(`${this.address}/cards`,{method:"POST",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})})}}({address:"https://nomoreparties.co/v1/cohort-50",owner:"me",token:"045f163c-447c-47f7-ad86-3f0afd434fd4"});V.getUserInfoFromServer().then((e=>e.ok?e.json():Promise.reject(e.status))).then((e=>{p.setUserInfo(e.name,e.about),a.src=e.avatar})).catch((e=>{console.log(e)})),V.getCard().then((e=>e.ok?e.json():Promise.reject(e.status))).then((e=>{e.forEach((e=>{U.push({name:e.name,link:e.link,id:e.owner._id,likes:e.likes.length+1,cardId:e._id,removeBtn:B,removePopup:w})}));for(let e=0;e<U.length;e++){U[e].name,U[e].link;const t=F(U[e],((e,t)=>{T.open(e,t)}),".template",(e=>{V.deleteLike(e)}),(e=>{V.addLike(e)}),(e=>{V.removeCard(e)}));y.prepend(t)}})).catch((e=>{console.log(e)})),p.getUserInfo(),p.setUserInfo(u,l),S.onclick=()=>{T.close()},k.onclick=()=>{A.open(),x.cleanForm(),x.setOffSubmitButton()},f.onclick=()=>{A.close()},v.onclick=()=>{P.close()},m.onclick=()=>{P.open(),u.value=p.getUserInfo().name,l.value=p.getUserInfo().about},d.onclick=()=>{$.close()},_.onclick=()=>{$.close()},h.onclick=()=>{$.open()},O.setEventListeners(),I.setValidation(),x.setValidation(),T.setEventListeners(),A.setEventListeners(),P.setEventListeners(),$.setEventListeners()})();